<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8'>
<base target='_top'>
<link rel='apple-touch-icon' href='html/screw.svg'>
<link rel='author' href='https://github.com/fasttime'>
<link rel='icon' href='html/favicon.ico'>
<meta http-equiv='X-UA-Compatible' content='IE=edge'>
<meta name='description' content='Converts plain JavaScript into JSFuck code, which uses only six
different characters: ! ( ) + [ ]'>
<meta name='viewport' content='width=device-width'>
<script src='lib/jscrewit.min.js'></script>
<script src='html/engine-selection-box.js'></script>
<script src='html/roll.js'></script>
<style>

* { box-sizing: border-box; }

.actions { display: block; margin: .25em 0 0; }

.actions a { float: right; }

.actions, .code, #controls, p { width: 100%; }

.code
{
    background-color: #e0e0e0;
    border-radius: .4em;
    display: block;
    margin: .75em 0;
    padding: .4em;
}

.code>*:first-child { display: inline-block; font-weight: bold; margin-bottom: .25em; }

.engineSelectionBox { background-color: #f0f0f0; }

.execSrc::after { content: 'Executable code'; }

.noWrap { white-space: nowrap; }

#compMenu { -webkit-appearance: menulist-button; width: 15em; }

#controls>*:first-child>*:not(:last-child) { margin-right: 1em; }

a { text-decoration: none; }

a:link { color: #00c; }

a:visited { color: #808; }

a:active { color: #c00; }

body { background-color: white; color: black; font-family: sans-serif; }

body, button, input[type=checkbox], select { font-size: 13.5pt; }

body>* { margin: 0 auto; max-width: 720px; text-align: justify; }

header { height: 100px; position: relative; width: 100%; }

h1 { font-size: 2em; font-weight: normal; left: 115px; position: absolute; top: 40px; }

h2 { font-weight: bold; }

img { background-color: blue; }

/* Hack for Firefox that doesn't interpret font-size on check boxes */
input[type=checkbox] { height: -moz-calc(13.5pt); width: -moz-calc(13.5pt); }

textarea { display: block; font: 12pt monospace; resize: vertical; width: 100%; }

</style>
<title>JScrewIt - Write any JavaScript with 6 Characters: ! ( ) + [ ]</title>

<body>
<div>
    <header>
        <h1>JScrewIt</h1>
        <img alt src='html/screw.svg' width='100' height='100'>
    </header>

    <p>JScrewIt converts plain JavaScript into JSFuck code, which uses only six different characters
    to write and run any code: <code>!</code> <code>(</code> <code>)</code> <code>+</code>
    <code>[</code> <code>]</code>

    <p>Use the form below to convert your own script. Uncheck <kbd class='execSrc'></kbd> to obtain
    a plain string.

    <div>
        <label class='code'>
            <span>Input</span>
            <textarea id='inputArea' rows='3'>alert(1)</textarea>
        </label>

        <div id='controls'>
            <div>
                <label>Compatibility:
                    <select autocomplete='off' id='compMenu'>
                        <option value='DEFAULT'>All supported engines
                        <option value='COMPACT'>All new browsers
                        <option value='NO_IE'>All except Internet Explorer (JSFuck mode)
                        <option value='AUTO'>Only this browser
                        <option value>Custom…
                    </select>
                </label>
                <label class='execSrc noWrap'>
                    <input id='wrapWithCallBox' type='checkbox' checked>
                </label>
                <button id='encodeButton'>Encode</button>
            </div>
        </div>

        <label class='code'>
            <span>Output</span>
            <textarea id='outputArea' rows='10'></textarea>
            <span class='actions'>
                <span id='stats'>…</span>
                <a id='run' href='#'>Run this</a>
            </span>
        </label>
    </div>

    <h2>Compatibility</h2>

    <p>JScrewIt itself and the code it generates are compatible with the JavaScript engines listed
    below.
    <ul>
        <li>Chrome 35+
        <li>Internet Explorer 9+
        <li>Firefox 30+
        <li>Safari 7.0+
        <li>Opera 22+
        <li>Microsoft Edge <i>(experimental support)</i>
        <li>Android Browser 4.0+
        <li>Node.js 0.10.26+
    </ul>

    <h2>Links</h2>

    <ul>
        <li>Documentation and source code on <a
        href='https://github.com/fasttime/JScrewIt'>GitHub</a>
        <li>Original discussion at <a
        href='http://sla.ckers.org/forum/read.php?24,32930'>Sla.ckers.org</a>
        <li>JSFuck introduction and alternatives on <a
        href='http://esolangs.org/wiki/JSFuck'>Esolang</a>
    </ul>
</div>
<script>

'use strict';

function createWorker()
{
    if (typeof Worker !== 'undefined')
    {
        try
        {
            worker = new Worker('html/worker.js');
        }
        catch (error)
        { }
    }
}

function encode()
{
    var output;
    var options = getOptions();
    try
    {
        output = JScrewIt.encode(inputArea.value, options);
    }
    catch (error)
    {
        resetOutput();
        updateError(error + '');
        return;
    }
    updateOutput(output);
}

function encodeAsync()
{
    var options = getOptions();
    var data = { input: inputArea.value, options: options };
    if (waitingForWorker)
    {
        queuedData = data;
    }
    else
    {
        worker.postMessage(data);
        resetOutput();
        setWaitingForWorker(true);
    }
    inputArea.onkeyup = null;
}

function getOptions()
{
    var compatibility = compMenu.options[compMenu.selectedIndex].value;
    var features =
        compatibility ?
        JScrewIt.commonFeaturesOf(compatibility) :
        engineSelectionBox.features;
    var wrapWith = wrapWithCallBox.checked ? 'call' : 'none';
    var options = { features: features, wrapWith: wrapWith };
    return options;
}

function handleInputAreaKeyUp(evt)
{
    if (evt.key !== 'Tab')
    {
        encodeAsync();
    }
}

function handleRunClick()
{
    try
    {
        var value = eval(outputArea.value);
    }
    catch (error)
    {
        alert(error);
        return false;
    }

    if (typeof value === 'string')
    {
        alert('"' + value + '"');
    }
    return false;
}

function handleWorkerMessage(evt)
{
    if (queuedData)
    {
        worker.postMessage(queuedData);
        queuedData = null;
    }
    else
    {
        var data = evt.data;
        var error = data.error;
        if (error)
        {
            updateError(data.error);
        }
        else
        {
            updateOutput(data.output);
        }
        setWaitingForWorker(false);
    }
}

function noEncode()
{
    if (outputSet)
    {
        updateStats(true);
    }
}

function resetOutput()
{
    outputSet = false;
    outputArea.value = '';
    stats.textContent = '…';
}

function setWaitingForWorker(value)
{
    waitingForWorker = value;
    outputArea.disabled = value;
}

function updateError(error)
{
    alert(error);
}

function updateOutput(output)
{
    outputArea.value = output;
    updateStats();
}

function updateStats(outOfSync)
{
    var length = outputArea.value.length;
    var html = length === 1 ? '1 char' : length + ' chars';
    if (outOfSync)
    {
        if (worker)
        {
            inputArea.onkeyup = handleInputAreaKeyUp;
        }
        html += ' – <i>out of sync</i>';
    }
    outputSet = true;
    stats.innerHTML = html;
}

var engineSelectionBox;
var outputSet;
var queuedData;
var roll;
var waitingForWorker;
var worker;

window.onload =
    function ()
    {
        inputArea.value = inputArea.defaultValue;
        wrapWithCallBox.checked = wrapWithCallBox.defaultChecked;
        roll = controls.appendChild(createRoll());
        var container = roll.appendChild(document.createElement('DIV'));
        container.className = 'code';
        container.appendChild(document.createElement('SPAN')).textContent =
            'Custom Engine Selection';
        engineSelectionBox = container.appendChild(createEngineSelectionBox());
        engineSelectionBox.className = 'engineSelectionBox';
        var changeHandler;
        if (worker)
        {
            encodeButton.parentNode.removeChild(encodeButton);
            changeHandler = encodeAsync;
            worker.onmessage = handleWorkerMessage;
            encodeAsync();
        }
        else
        {
            encodeButton.onclick = encode;
            changeHandler = noEncode;
            outputArea.value = '';
        }
        inputArea.oninput = changeHandler;
        wrapWithCallBox.onchange = changeHandler;
        compMenu.selectedIndex = compMenu.previousIndex = 0;
        var compMenuHandler =
            function ()
            {
                var selectedIndex = compMenu.selectedIndex;
                if (selectedIndex !== compMenu.previousIndex)
                {
                    compMenu.previousIndex = selectedIndex;
                    changeHandler();
                    var compatibility = compMenu.options[compMenu.selectedIndex].value;
                    roll.rollTo(compatibility ? 0 : 1);
                }
            };
        compMenu.onchange = compMenuHandler;
        // Firefox does not always trigger a change event when an option is selected using the
        // keyboard; we must handle keydown events asynchronously, too.
        compMenu.onkeydown = setTimeout.bind(null, compMenuHandler);
        engineSelectionBox.addEventListener('change', changeHandler);
        if (inputArea.createTextRange)
        {
            var range = inputArea.createTextRange();
            range.move('textedit', 1);
            range.select();
        }
        else
        {
            inputArea.setSelectionRange(0x7fffffff, 0x7fffffff);
        }
        inputArea.focus();
    };

createWorker();
run.onclick = handleRunClick;
outputArea.oninput = updateStats;

</script>
